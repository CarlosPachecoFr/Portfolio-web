---
// @ts-nocheck
const { img, titulo, descripcion, tecnologias, enlace, stack, video } = Astro.props;
---
<div class="shadow-lg rounded-xl bg-white mx-6 md:mx-0 overflow-hidden flex flex-col transition-all duration-300 ease-out hover:scale-[1.02] hover:shadow-2xl hover:-translate-y-2 group">
    <div class="relative">
        <img class="w-full h-40 object-cover" src={ img } alt="">
        <div class="absolute top-3 left-3  bg-[#33ce33d5] text-white text-xs font-semibold px-2 py-1 rounded-lg transition-all duration-300 group-hover:bg-[#22CA22] group-hover:scale-105 group-hover:shadow-lg">
            <p class="">{ stack }</p>
        </div>
    </div>
    <div class="p-6 flex flex-col flex-1">
        <p class="text-xl font-bold transition-colors duration-300 group-hover:text-[#1DB01D]">{ titulo }</p>
        <p class="text-justify text-[16px] text-gray-600 flex-1 pt-1 transition-colors duration-300 group-hover:text-gray-700">{ descripcion }</p>
        <div class="grid grid-cols-3 gap-2 mt-3">
            {tecnologias.map(tecnologia => (
                <div class="bg-[#E7F8E7] border-1 border-[#BEEEBE] text-[#52D552] flex items-center justify-center p-1 text-[12px] rounded-lg">
                    <img class="w-5 h-5" src={ tecnologia.img } alt={ tecnologia.nombre }>
                    <p class="pl-1 truncate font-semibold">{ tecnologia.nombre }</p>
                </div>
            ))}
        </div>
        <div class="mt-5 grid grid-cols-1 md:grid-cols-2 gap-3">
            <a href={ enlace } target="_blank" rel="noopener noreferrer" class="bg-[#33CE33] w-full cursor-pointer text-white text-sm p-2 font-semibold rounded-lg inline-block text-center transition-all duration-300 hover:bg-[#22CA22] hover:shadow-lg hover:scale-[1.02] hover:-translate-y-0.5 active:scale-[0.98]">
                <div class="flex items-center justify-center">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 0C5.373 0 0 5.373 0 12c0 5.303 3.438 9.8 8.205 11.387.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.544-1.38-1.33-1.75-1.33-1.75-1.09-.745.082-.73.082-.73 1.205.084 1.838 1.235 1.838 1.235 1.068 1.825 2.804 1.297 3.493.993.107-.774.418-1.297.761-1.597-2.667-.303-5.467-1.334-5.467-5.933 0-1.31.468-2.38 1.236-3.22-.124-.303-.536-.91.118-1.84 0 0 1.016-.324 3.33 1.23.968-.269 2.004-.403 3.032-.403 1.028 0 2.064.134 3.032.403 2.314-1.554 3.33-1.23 3.33-1.23.654.93.242 1.537.118 1.84.768.84 1.236 1.91 1.236 3.22 0 4.61-2.8 5.63-5.467 5.933.343.3.654.89.654 1.79 0 1.29-.015 2.33-.015 2.65 0 .32.22.693.825.577C20.563 21.8 24 17.303 24 12c0-6.627-5.373-12-12-12z"/>
                        </svg>
                        <p>GitHub</p>
                </div>
            </a>
            <a data-video={ video } class="playVideoBtn border-[#33CE33] border-1 w-full cursor-pointer text-[#33CE33] p-2 text-sm font-semibold rounded-lg inline-block text-center ease-in-out duration-300 hover:bg-[#33CE33] hover:text-white">
                <div class="flex items-center justify-center">
                    <svg class="w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M16 2H0V14H16V2ZM6.5 5V11H7.5L11 8L7.5 5H6.5Z" fill="currentColor"/>
                    </svg>
                    <p>Ver vídeo</p>
                </div>
            </a>
        </div>
    </div>
</div>
<!-- Modal -->
<div id="videoModal" class="fixed inset-0 bg-black/30 backdrop-blur-sm items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg overflow-hidden relative w-[90%] max-w-2xl shadow-xl">
    <button id="closeModal" 
            class="absolute top-2 right-2 text-gray-600 hover:text-black text-2xl font-bold z-10">
      &times;
    </button>
        <video id="videoPlayer" class="w-full" controls playsinline>
            <source src={ video } type="video/mp4">
            Tu navegador no soporta vídeo.
        </video>
    </div>
</div>

<script>
    const playBtns = document.querySelectorAll('.playVideoBtn') as NodeListOf<HTMLElement>;
    const modal = document.getElementById('videoModal');
    const video = document.getElementById('videoPlayer') as HTMLVideoElement;
    const closeBtn = document.getElementById('closeModal');

    if(playBtns && modal && video && closeBtn) {
        playBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                const videoSrc = btn.dataset.video;
                (video.querySelector('source') as HTMLSourceElement).src = videoSrc!;
                video.load();
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                video.play();
            });
        });

        closeBtn.addEventListener('click', () => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            video.pause();
            video.currentTime = 0;
        });

        // Cerrar modal al hacer clic fuera del contenido
        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                video.pause();
                video.currentTime = 0;
            }
        });
    }
</script>